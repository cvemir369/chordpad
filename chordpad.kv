#:import SwapTransition kivy.uix.screenmanager.SwapTransition

<TopLabel@Label>
    font_size: min(self.height-5, self.width/25)

<ButtonAll@Button>
    font_size: min(self.height-5, self.width/15)

<ButtonKey@Button>
    font_size: min(self.height-5, self.width/4.2)

<ButtonConfirm@Button>
    font_size: min(self.height-5, self.width/10)

<ConfirmTextInput@TextInput>
    padding:
        [0, self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0, 0]
    font_size: min(root.height-5, root.width/16)


<ScreenOrganize>:
    transition: SwapTransition()
    MenuScreen:
        name: "menu"
    ReadingModeScreen:
        name: "reading"
    ChordpadScreen:
        name: "editing"
    SuccessScreen:
        name: "success"


<SuccessScreen>
    name: "success"
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        Label:
            size_hint: (1, 0.7)
            text: "Success!"
            halign: "center"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            font_style: "Caption"
        ButtonAll:
            size_hint: 1, 0.1
            text: "Back to Main Menu"
            # font_size: self.width/20
            on_release: root.manager.current = "menu"
        ButtonAll:
            size_hint: 1, 0.1
            text: "Back to Edit Mode"
            # font_size: self.width/20
            on_release: root.manager.current = "editing"
        ButtonAll:
            size_hint: 1, 0.1
            text: "Back to Reading Mode"
            # font_size: self.width/20
            on_release: root.manager.current = "reading"


<MenuScreen>
    name: "menu"
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        TopLabel:
            size_hint: (1, 0.05)
            text: "Chordpad by cvemir369"
            halign: "center"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            font_style: "Caption"
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            StackLayout:
                id: pads
                scroll_type: ['bars', 'content']
                bar_width: 10
                padding: [10,10,10,10]
                size_hint: 1, None
                size: root.width, root.height
        Label: #empty separator
            size_hint: 1, 0.01
        ButtonAll:
            size_hint: 1, 0.08
            text: "New chordpad"
            on_release:
                root.new_chordpad()
                root.manager.current = "editing"
        ButtonAll:
            id: back_to_chordpad
            size_hint: 1, 0.08
            text: "Back to chordpad"
            on_release:
                root.back_to_chordpad()
                root.manager.current = "editing"


<ReadingModeScreen>
    name: "reading"
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height

        TopLabel:
            id: filename_rlabel
            size_hint: (1, 0.05)
            halign: "center"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            font_style: "Caption"
        ButtonAll:
            text: "Main Menu"
            size_hint: (1, 0.1)
            on_release: root.manager.current = "menu"
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            scroll_type: ['bars', 'content']
            bar_width: 10
            Label:
                id: reading_label
                size_hint: 1, None
                size: self.texture_size
                text_size: root.width, None
                halign: "center"
                valign: "center"
                font_size: self.width/16
                
        ButtonAll:
            text: "Edit Chordpad"
            size_hint: (1, 0.1)
            on_release: root.manager.current = "editing"
        ButtonAll:
            text: "Delete Chordpad"
            size_hint: (1, 0.1)
            on_release: root.delete_pad()


<ChordpadScreen>
    name: "editing"
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height

        TopLabel:
            id: filename_label
            size_hint: (1, 0.05)
            halign: "center"
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1
            font_style: "Caption"
        ButtonAll:
            text: "Main Menu"
            size_hint: (1, 0.1)
            on_release:
                root.check_if_saved("menu")
        ButtonAll:
            text: "Reading Mode"
            size_hint: (1, 0.1)
            on_release:
                root.check_if_saved("reading")
                root.manager.get_screen("reading").ids.reading_label.text = chordpad.text

        ScrollView:
            id: scrlv
            do_scroll_x: False
            do_scroll_y: True
            scroll_type: ['bars', 'content']
            bar_width: 10
            TextInput: # chordpad
                id: chordpad
                size_hint: 1, None
                height: max(self.minimum_height, scrlv.height)
                halign: "center"
                valign: "center"
                font_size: self.width/15
                auto_indent: True
                background_color: (240/255, 240/255, 240/255, 1)
                hint_text: "Empty Chordpad"
                use_bubble: True
                # use_handles: True

        GridLayout:
            cols: 6
            size_hint: (1, 0.4)
            ButtonKey:
                text: "INTRO"
                on_release: root.put_text("INTRO")
            ButtonKey:
                text: "VERSE"
                on_release: root.put_text("VERSE")
            ButtonKey:
                text: "PRE-CH"
                on_release: root.put_text("PRE-CHORUS")
            ButtonKey:
                text: "CHORUS"
                on_release: root.put_text("CHORUS")
            ButtonKey:
                text: "BRIDGE"
                on_release: root.put_text("BRIDGE")
            ButtonKey:
                text: "OUTRO"
                on_release: root.put_text("OUTRO")
            ButtonKey:
                text: "B"
                on_release: chordpad.insert_text(" B")
            ButtonKey:
                text: "C"
                on_release: chordpad.insert_text(" C")
            ButtonKey:
                text: "C#"
                on_release: chordpad.insert_text(" C#")
            ButtonKey:
                text: "D"
                on_release: chordpad.insert_text(" D")
            ButtonKey:
                text: "D#"
                on_release: chordpad.insert_text(" D#")
            ButtonKey:
                text: "E"
                on_release: chordpad.insert_text(" E")
            ButtonKey:
                text: "F"
                on_release: chordpad.insert_text(" F")
            ButtonKey:
                text: "F#"
                on_release: chordpad.insert_text(" F#")
            ButtonKey:
                text: "G"
                on_release: chordpad.insert_text(" G")
            ButtonKey:
                text: "G#"
                on_release: chordpad.insert_text(" G#")
            ButtonKey:
                text: "A"
                on_release: chordpad.insert_text(" A")
            ButtonKey:
                text: "A#"
                on_release: chordpad.insert_text(" A#")
            ButtonKey:
                text: "7"
                on_release: chordpad.insert_text("7")
            ButtonKey:
                text: "m"
                on_release: chordpad.insert_text("m")
            ButtonKey:
                text: "m7"
                on_release: chordpad.insert_text("m7")
            ButtonKey:
                text: "x2"
                on_release: chordpad.insert_text(" (x2)")
            ButtonKey:
                text: "x3"
                on_release: chordpad.insert_text(" (x3)")
            ButtonKey:
                text: "x4"
                on_release: chordpad.insert_text(" (x4)")
            ButtonKey:
                text: "Save"
                on_release: root.check_if_saved("editing")
            ButtonKey:
                text: "Rename"
                on_release: root.rename_chordpad()
            ButtonKey:
                text: "Enter"
                on_release: chordpad.insert_text("\n")
            ButtonKey:
                text: "Undo"
                on_release: chordpad.do_undo()
            ButtonKey:
                text: "Redo"
                on_release: chordpad.do_redo()
            ButtonKey:
                text: "Delete"
                on_release: root.delete_pad()


<SaveAsDialog>
    title: "Save As"
    size_hint: (0.8,0.2)
    FloatLayout:
        ConfirmTextInput:
            id: filename
            focus: True
            hint_text: "Untitled Chordpad"
            multiline: False
            halign: "center"
            valign: "center"
            size_hint: 0.9, 0.3
            pos_hint: {'x':0.05, 'y':0.55}
            on_text_validate: root.save_as()
        ButtonConfirm:
            text: "Save"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0, 'y':0.1}
            on_release: root.save_as()
        ButtonConfirm:
            id: cancel_pressed
            text: "Discard"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.5, 'y':0.1}
            on_release: root.dismiss()


<SaveChangesDialog>
    title: root.current_pad_title()
    size_hint: (0.8,0.2)
    auto_dismiss: False
    FloatLayout:
        Label:
            text: "Save Changes?"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.25, 'y':0.58}
            font_size: min(self.height-5, self.width/8)
        ButtonConfirm:
            text: "Yes"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0, 'y':0.1}
            on_release: root.save_changes()
        ButtonConfirm:
            text: "No"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.5, 'y':0.1}
            on_release: root.dismiss()


<DeletePadDialog>
    title: root.current_pad_title()
    size_hint: (0.8,0.2)
    auto_dismiss: False
    FloatLayout:
        Label:
            text: "Are you sure?"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.25, 'y':0.58}
            font_size: min(self.height-5, self.width/8)
        ButtonConfirm:
            text: "Yes"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0, 'y':0.1}
            on_release: root.delete_pad()
        ButtonConfirm:
            text: "No"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.5, 'y':0.1}
            on_release: root.dismiss()


<RenamePadDialog>
    title: root.current_pad_title()
    size_hint: (0.8,0.2)
    FloatLayout:
        ConfirmTextInput:
            id: rename_name
            focus: True
            # hint_text: root.rename_hint_text()
            text: root.rename_hint_text()
            multiline: False
            halign: "center"
            valign: "center"
            size_hint: 0.9, 0.3
            pos_hint: {'x':0.05, 'y':0.58}
            on_text_validate: root.rename_chordpad()
        ButtonConfirm:
            text: "Rename"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0, 'y':0.1}
            on_release: root.rename_chordpad()
        ButtonConfirm:
            id: cancel_pressed
            text: "Cancel"
            size_hint: 0.5, 0.3
            pos_hint: {'x':0.5, 'y':0.1}
            on_release: root.dismiss()
